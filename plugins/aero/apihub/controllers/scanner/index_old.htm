<?= Form::open(['id' => 'searchForm']) ?>
    <div class="layout-item stretch layout-column">
        <div class="control-toolbar">
            <h4><i class="icon-download"></i> Import APIs from APIs.guru</h4>
        </div>

        <!-- APIs.guru Info -->
        <?php if ($connectionOk): ?>
            <div class="callout callout-success">
                <div class="header">
                    <i class="icon-check-circle"></i>
                    <h3>✅ Connected to APIs.guru</h3>
                </div>
                <div class="content">
                    <p><strong>APIs.guru</strong> is a free, open-source repository of OpenAPI/Swagger specifications for thousands of public APIs.</p>
                    <ul>
                        <li>Search and import APIs with complete endpoint documentation</li>
                        <li>Auto-parse OpenAPI specs to extract routes, parameters, and responses</li>
                        <li>Import happens in background queue</li>
                        <li>All data cached with Redis for performance</li>
                    </ul>
                </div>
            </div>
        <?php else: ?>
            <div class="callout callout-warning">
                <div class="header">
                    <i class="icon-exclamation-triangle"></i>
                    <h3>⚠️ Connection Issue</h3>
                </div>
                <div class="content">
                    <p>Unable to connect to APIs.guru. Please check your internet connection.</p>
                </div>
            </div>
        <?php endif ?>

        <!-- Search Section -->
        <div class="layout-row min-size">
            <div class="scoreboard">
                <div class="scoreboard-item">
                    <h6>Total APIs</h6>
                    <p class="metric"><?= $stats['total_apis'] ?></p>
                </div>
                <div class="scoreboard-item">
                    <h6>Total Endpoints</h6>
                    <p class="metric"><?= $stats['total_endpoints'] ?></p>
                </div>
                <div class="scoreboard-item">
                    <h6>Recently Synced</h6>
                    <p class="metric"><?= $stats['recently_synced'] ?></p>
                </div>
                <div class="scoreboard-item">
                    <h6>Needs Sync</h6>
                    <p class="metric"><?= $stats['needs_sync'] ?></p>
                </div>
            </div>
        </div>

        <!-- Search Form -->
        <div class="form-group">
            <label>Search APIs.guru Catalog</label>
            <div class="input-group">
                <input
                    type="text"
                    name="search_term"
                    class="form-control"
                    placeholder="Search by name (e.g., github, stripe, twitter, openai)"
                    value="">
                <span class="input-group-btn">
                    <button
                        type="button"
                        class="btn btn-primary"
                        data-request="onSearch"
                        data-request-update="search_results: #searchResults">
                        <i class="icon-search"></i> Search
                    </button>
                </span>
            </div>
            <p class="help-block">Search thousands of OpenAPI specifications from popular APIs</p>
        </div>

        <!-- Quick Import Popular -->
        <div class="form-group">
            <label>Quick Import Popular APIs by Category</label>
            <div class="btn-group">
                <button
                    type="button"
                    class="btn btn-default"
                    data-request="onImportPopular"
                    data-request-data="category: 'financial', limit: 5"
                    data-request-confirm="Import 5 popular Financial APIs?">
                    <i class="icon-dollar"></i> Financial
                </button>
                <button
                    type="button"
                    class="btn btn-default"
                    data-request="onImportPopular"
                    data-request-data="category: 'social', limit: 5"
                    data-request-confirm="Import 5 popular Social APIs?">
                    <i class="icon-users"></i> Social
                </button>
                <button
                    type="button"
                    class="btn btn-default"
                    data-request="onImportPopular"
                    data-request-data="category: 'cloud', limit: 5"
                    data-request-confirm="Import 5 popular Cloud APIs?">
                    <i class="icon-cloud"></i> Cloud
                </button>
                <button
                    type="button"
                    class="btn btn-default"
                    data-request="onImportPopular"
                    data-request-data="category: 'developer_tools', limit: 5"
                    data-request-confirm="Import 5 popular Developer Tools APIs?">
                    <i class="icon-code"></i> Dev Tools
                </button>
            </div>
            <p class="help-block">Import top 5 APIs from each category (queued in background)</p>
        </div>

        <!-- Results Section -->
        <div id="searchResults" class="layout-item stretch">
            <?= $this->makePartial('search_results', ['results' => []]) ?>
        </div>
    </div>
<?= Form::close() ?>
