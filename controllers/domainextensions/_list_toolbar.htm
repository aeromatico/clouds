<div data-control="toolbar">
    <a href="<?= Backend::url('aero/clouds/domainextensions/create') ?>" class="btn btn-primary oc-icon-plus">
        New Domain Extension
    </a>

    <button
        type="button"
        class="btn btn-default oc-icon-money"
        onclick="$('#salePriceModal').modal('show');">
        Configure Sale Prices
    </button>

    <button
        class="btn btn-default oc-icon-trash-o"
        disabled="disabled"
        onclick="$(this).data('request-data', {
            checked: $('.control-list').listWidget('getChecked')
        })"
        data-request="onDelete"
        data-request-confirm="Are you sure you want to delete selected domain extensions?"
        data-trigger-action="enable"
        data-trigger=".control-list input[type=checkbox]"
        data-trigger-condition="checked"
        data-request-success="$(this).prop('disabled', true)"
        data-stripe-load-indicator>
        Delete Selected
    </button>
</div>

<!-- Modal for sale price configuration -->
<div id="salePriceModal" class="modal fade" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Configure Sale Prices</h4>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Markup Type</label>
                    <select id="markup_type" class="form-control">
                        <option value="percentage">Percentage (%)</option>
                        <option value="fixed">Fixed Amount</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Markup Value</label>
                    <input type="number" id="markup_value" class="form-control" step="0.01" min="0" placeholder="Enter value">
                    <p class="help-block" id="markup_help">Enter percentage (e.g., 20 for 20% markup)</p>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="applySalePrices()">Apply to All</button>
            </div>
        </div>
    </div>
</div>

<script>
// Update help text when markup type changes
$(document).on('change', '#markup_type', function() {
    var type = $(this).val();
    var $help = $('#markup_help');

    if (type === 'percentage') {
        $help.text('Enter percentage (e.g., 20 for 20% markup)');
    } else {
        $help.text('Enter fixed amount to add (e.g., 5.00)');
    }
});

// Apply sale prices
function applySalePrices() {
    var markupType = $('#markup_type').val();
    var markupValue = parseFloat($('#markup_value').val());

    if (isNaN(markupValue) || markupValue < 0) {
        $.oc.flashMsg({text: 'Please enter a valid markup value', class: 'error'});
        return;
    }

    // Close modal
    $('#salePriceModal').modal('hide');

    // Make AJAX request
    $.request('onApplySalePrices', {
        data: {
            markup_type: markupType,
            markup_value: markupValue
        },
        success: function(data) {
            $.oc.flashMsg({text: data.message, class: 'success'});
            $('[data-control=listwidget]').listWidget('refresh');
        },
        error: function(jqXHR) {
            var errorMsg = 'Error applying sale prices';
            if (jqXHR.responseJSON && jqXHR.responseJSON.X_OCTOBER_ERROR_MESSAGE) {
                errorMsg = jqXHR.responseJSON.X_OCTOBER_ERROR_MESSAGE;
            }
            $.oc.flashMsg({text: errorMsg, class: 'error'});
        }
    });
}
</script>
