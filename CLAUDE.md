# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is a modern OctoberCMS 4.0 installation with a comprehensive technology stack including Vite, Tailwind CSS, Alpine.js, and PWA support. The project features the "Master" theme developed by "aero" with complete modern web development tooling.

## Production Environment - CloudPanel

**IMPORTANT:** This application is deployed on a **CloudPanel** managed server at `clouds.com.bo` and operates in a **LIVE PRODUCTION** environment.

**Critical Considerations:**
- **Multi-tenant environment**: Multiple sites share the same server
- **Live domain**: All changes affect the production website immediately
- **No staging environment**: All development happens directly on production
- **Shared resources**: Database, Redis, and file system are shared with other sites
- **Permissions**: Work within `/home/clouds/htdocs/clouds.com.bo/` only

**Working Directory:** `/home/clouds/htdocs/clouds.com.bo/`
**Theme Directory:** `/home/clouds/htdocs/clouds.com.bo/themes/master/`
**Domain:** `https://clouds.com.bo`

## Stack Architecture

**Backend Framework:**
- OctoberCMS 4.0 (Laravel 12.23.1)
- PHP 8.2.29
- MySQL 8 database
- Redis for caching, sessions, and queues

**Frontend Stack:**
- Vite 5.4.19 (development server with HMR)
- Tailwind CSS 3.4 (utility-first CSS framework)
- Alpine.js 3.14 (lightweight reactive framework)
- Font Awesome 6 (icon library)
- Animate.css (animation library)
- Google Fonts (Inter, JetBrains Mono)
- DaisyUI 5.0.50 (Tailwind component library)

**PWA Features:**
- Service Worker with Workbox
- Web App Manifest (auto-generated by Vite)
- Offline support
- Install prompts (positioned bottom-left, dismissible)
- Background sync

**Development Tools:**
- PostCSS with Autoprefixer
- Legacy browser support
- Hot Module Replacement (HMR)
- TypeScript definitions

## Production Commands

**Always run from the theme directory:** `/home/clouds/htdocs/clouds.com.bo/themes/master`

```bash
# Production build with optimizations (REQUIRED after JS/CSS changes)
npm run build

# Development with HMR (for testing only)
npm run dev

# Preview production build locally
npm run preview

# Install dependencies
npm install

# Update dependencies
npm update
```

**System Commands (from project root):**
```bash
cd /home/clouds/htdocs/clouds.com.bo

# Clear application cache
php artisan cache:clear

# Clear configuration cache
php artisan config:clear

# View system information
php artisan october:about

# Redis status check
redis-cli ping
```

## Current System Status

**‚úÖ Operational Components:**
- OctoberCMS 4.0 fully installed and configured
- MySQL database connected and operational
- Redis caching, sessions, and queues working
- Master theme active and functional
- Vite build system operational
- PWA features implemented and working
- Dark/Light theme toggle functional
- PWA install prompt (bottom-left, dismissible)
- Mobile navigation and responsive design
- Alpine.js components and stores

**üìÅ Theme Structure:**

```
themes/master/
‚îú‚îÄ‚îÄ assets/
‚îÇ   ‚îú‚îÄ‚îÄ src/           # Source files
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ css/       # Tailwind CSS source
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ js/        # Alpine.js components
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ pwa/       # PWA configuration files
‚îÇ   ‚îî‚îÄ‚îÄ dist/          # Compiled production assets
‚îú‚îÄ‚îÄ layouts/           # Twig layout templates
‚îú‚îÄ‚îÄ pages/             # Page templates
‚îú‚îÄ‚îÄ partials/          # Reusable components
‚îú‚îÄ‚îÄ vite.config.js     # Vite build configuration
‚îú‚îÄ‚îÄ tailwind.config.js # Tailwind CSS configuration
‚îî‚îÄ‚îÄ theme.yaml         # Theme configuration
```

**üîß Key Configuration Files:**
- `/home/clouds/htdocs/clouds.com.bo/.env` - Environment configuration
- `themes/master/assets/src/js/app.js` - Main JavaScript entry point
- `themes/master/assets/src/css/app.css` - Main CSS entry point
- `themes/master/layouts/default.htm` - Base layout template

## Custom Plugins

**Aero Vite Plugin:** `plugins/aero/vite/`
- Provides Twig functions for Vite asset integration
- Handles development vs production asset loading
- Functions: `vite()`, `vite_client()`, `vite_entry_tags()`

**Aero Clouds Plugin:** `plugins/aero/clouds/`
- Complete hosting management system
- REST API with Redis cache optimization
- **Documentation:** See `plugins/aero/clouds/CLOUDS_API_SYSTEM.md`

## Clouds API System

**Status:** ‚úÖ Fully Implemented (January 2025)

**Architecture:** Hybrid API system combining:
1. **ApiDispatcher** - For complex queries and microfrontends
2. **FormHandler + CloudsForm** - For simple web forms

**Main Endpoint:** `POST /api`

**Key Features:**
- ‚úÖ Unified REST API for all CRUD operations
- ‚úÖ Redis cache optimization for large queries
- ‚úÖ Auto-discovery of models and relations
- ‚úÖ Dynamic scopes and eager loading
- ‚úÖ Schema auto-documentation
- ‚úÖ Perfect for microfrontends and SPAs

**Quick Example:**
```javascript
// From any frontend (React, Vue, vanilla JS)
fetch('/api', {
  method: 'POST',
  body: JSON.stringify({
    model: 'order',
    action: 'list',
    scope: 'pending,recent',
    with: 'user:id,email|invoice:id,total',
    fields: 'id,order_date,status,total_amount',
    limit: 20
  })
})
```

**Components:**
- `ApiDispatcher.php` - Main dispatcher with cache
- `ApiCache.php` - Redis cache manager
- `FormHandler.php` - Trait for CRUD operations
- `CloudsForm` - Generic form component
- `routes.php` - Unified API routes

**Cache Management:**
```bash
# Stats
GET /api/cache/stats

# Flush all
POST /api/cache/flush

# Invalidate specific model
POST /api/cache/invalidate/order
```

**Important:** The main `/api` endpoint is handled by aero/clouds. The old aero/manager `/api` was moved to `/api/manager`.

**Complete Documentation:** `/plugins/aero/clouds/CLOUDS_API_SYSTEM.md`

## Alpine.js Architecture

**Global Stores:**
- `theme` - Dark/light theme management with localStorage persistence
- `navigation` - Mobile navigation state
- `toast` - Notification system with auto-dismiss
- `pwa` - PWA installation handling and prompts

**Available Components:**
- `themeToggle` - Theme switcher (light/dark/system)
- `mobileNav` - Mobile navigation
- `modal` - Modal dialogs with backdrop
- `dropdown` - Dropdown menus
- `carousel` - Image carousel with autoplay
- `tabs` - Tab navigation
- `accordion` - Collapsible content
- `search` - Search functionality
- `formValidation` - Form validation with rules
- `lazyLoad` - Intersection Observer lazy loading
- `pwaInstall` - PWA installation component (bottom-left)
- `toastContainer` - Toast notification display

## Database & Cache Configuration

**Current Configuration:**
- **Host:** localhost
- **Database:** master
- **Username:** master  
- **Redis:** Configured for cache, sessions, and queues
- **Cache Driver:** Redis (DB 1)
- **Session Driver:** Redis (DB 2) 
- **Queue Driver:** Redis (DB 3)

## Theme System

**Dark/Light Mode:**
- CSS variables for consistent theming
- Auto-detection of system preference
- Manual toggle with localStorage persistence
- Smooth transitions between themes
- System preference detection

**Color System:**
- Primary: Blue color palette (#0ea5e9)
- Secondary: Gray color palette
- Custom CSS variables in `:root` and `[data-theme="dark"]`
- DaisyUI integration for components

## PWA Configuration

**Status:** ‚úÖ Fully Operational
- **Manifest:** Auto-generated by Vite at `assets/dist/manifest.webmanifest`
- **Service Worker:** Auto-generated by Vite PWA plugin
- **Install Prompt:** Custom component, bottom-left position, dismissible
- **Features:** Offline functionality, background sync, cache strategies

## Performance Features

- Code splitting with Vite
- Tree shaking for unused code
- Asset compression and minification
- Legacy browser support
- Preloading critical resources
- Optimized font loading
- Image lazy loading
- Redis caching for performance

## Security Considerations

**Production Environment:**
- CSP headers configured in .htaccess
- XSS protection enabled
- Content type sniffing disabled
- Referrer policy configured
- Protected directories and files
- Environment variables secured

**CloudPanel Environment:**
- Work only within assigned directory
- Respect file permissions (775)
- Avoid affecting other sites
- Monitor resource usage

## Development Workflow

**For JavaScript/CSS Changes:**
1. Edit source files in `themes/master/assets/src/`
2. **ALWAYS run `npm run build`** to compile for production
3. Clear application cache: `php artisan cache:clear`
4. Test changes on live domain

**For Template Changes:**
1. Edit `.htm` files in `layouts/`, `pages/`, or `partials/`
2. Changes are immediately visible (no build required)
3. Clear cache if needed: `php artisan cache:clear`

## Troubleshooting

**Build Issues:**
- Ensure Node.js 18+ is installed
- Run `npm install` if dependencies are missing
- Check for CSS/JS syntax errors in console
- Verify file permissions (775)

**Theme Issues:**
- Verify `ACTIVE_THEME=master` in `.env`
- Check Vite plugin integration
- Ensure assets are built with `npm run build`
- Clear cache: `php artisan cache:clear`

**PWA Issues:**
- Manifest generated automatically by Vite
- Service Worker handles caching
- Install prompt appears after 3 seconds if installable

## Microfrontend Architecture

**Implementation Status:** ‚úÖ Active
- User Dashboard microfrontend
- User Profile microfrontend  
- API management system
- Component isolation and communication
- Documentation in `MICROFRONTENDS.md`

## Important Reminders

1. **Production Environment**: All changes are LIVE immediately
2. **Build Requirement**: Always run `npm run build` after JS/CSS changes
3. **Multi-tenant**: Be mindful of other sites on the server
4. **Permissions**: Maintain proper file permissions (775)
5. **Testing**: Test thoroughly as there's no staging environment
6. **Cache**: Clear cache after major changes
7. **Backup**: Consider backing up before major changes