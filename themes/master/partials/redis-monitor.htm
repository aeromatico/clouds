<!-- Redis Monitor Panel -->
<div 
    x-data="redisMonitor" 
    x-init="init()" 
    data-component="redis-monitor"
    class="bg-card rounded-lg shadow-lg p-6"
>
    <!-- Header -->
    <div class="flex items-center justify-between mb-6">
        <h2 class="text-xl font-bold text-card-foreground flex items-center">
            <i class="fas fa-database mr-2 text-red-500"></i>
            Redis Monitor
        </h2>
        <div class="flex items-center space-x-2">
            <!-- Auto refresh toggle -->
            <label class="flex items-center space-x-2 text-sm">
                <input 
                    type="checkbox" 
                    x-model="autoRefresh" 
                    @change="toggleAutoRefresh()"
                    class="rounded border-border"
                >
                <span class="text-muted-foreground">Auto refresh</span>
            </label>
            
            <!-- Manual refresh -->
            <button 
                @click="loadStats()"
                :disabled="loading"
                class="btn btn-outline btn-sm"
                title="Actualizar estadísticas"
            >
                <i class="fas fa-sync-alt" :class="{ 'animate-spin': loading }"></i>
            </button>
        </div>
    </div>

    <!-- Connection Status -->
    <div class="mb-6">
        <div class="flex items-center space-x-2 mb-2">
            <div 
                class="w-3 h-3 rounded-full"
                :class="connected ? 'bg-green-500' : 'bg-red-500'"
            ></div>
            <span class="font-medium text-foreground">
                Estado de Conexión: 
                <span :class="connected ? 'text-green-600' : 'text-red-600'">
                    <span x-text="connected ? 'Conectado' : 'Desconectado'"></span>
                </span>
            </span>
        </div>
        <div x-show="stats.redis_version" class="text-sm text-muted-foreground">
            Redis v<span x-text="stats.redis_version"></span> - 
            Uptime: <span x-text="formatUptime(stats.uptime_in_seconds)"></span>
        </div>
    </div>

    <!-- Error State -->
    <div x-show="error" x-transition class="bg-destructive/10 border border-destructive/20 rounded-lg p-4 mb-6">
        <div class="flex items-center space-x-2 text-destructive">
            <i class="fas fa-exclamation-triangle"></i>
            <span class="font-medium">Error:</span>
            <span x-text="error"></span>
        </div>
    </div>

    <!-- Stats Grid -->
    <div x-show="!loading && connected" x-transition class="space-y-6">
        
        <!-- Key Metrics -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
            <!-- Memory Usage -->
            <div class="bg-muted/30 rounded-lg p-4 text-center">
                <div class="text-2xl font-bold text-blue-600" x-text="formatBytes(stats.used_memory)"></div>
                <div class="text-sm text-muted-foreground">Memoria Usada</div>
                <div class="text-xs text-muted-foreground mt-1">
                    Max: <span x-text="formatBytes(stats.maxmemory)"></span>
                </div>
            </div>

            <!-- Total Keys -->
            <div class="bg-muted/30 rounded-lg p-4 text-center">
                <div class="text-2xl font-bold text-green-600" x-text="stats.total_keys || 0"></div>
                <div class="text-sm text-muted-foreground">Total Keys</div>
                <div class="text-xs text-muted-foreground mt-1">
                    En todas las DB
                </div>
            </div>

            <!-- Commands/sec -->
            <div class="bg-muted/30 rounded-lg p-4 text-center">
                <div class="text-2xl font-bold text-yellow-600" x-text="stats.instantaneous_ops_per_sec || 0"></div>
                <div class="text-sm text-muted-foreground">Ops/seg</div>
                <div class="text-xs text-muted-foreground mt-1">
                    Operaciones por segundo
                </div>
            </div>

            <!-- Hit Rate -->
            <div class="bg-muted/30 rounded-lg p-4 text-center">
                <div class="text-2xl font-bold text-purple-600" x-text="getHitRate() + '%'"></div>
                <div class="text-sm text-muted-foreground">Hit Rate</div>
                <div class="text-xs text-muted-foreground mt-1">
                    Cache effectiveness
                </div>
            </div>
        </div>

        <!-- Database Info -->
        <div>
            <h3 class="font-semibold text-foreground mb-3">Databases</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3">
                <template x-for="(db, index) in databases" :key="index">
                    <div class="bg-background border border-border rounded-lg p-3">
                        <div class="flex items-center justify-between mb-2">
                            <span class="font-medium text-foreground">DB <span x-text="index"></span></span>
                            <span class="text-sm text-muted-foreground" x-text="getDatabasePurpose(index)"></span>
                        </div>
                        <div class="text-sm">
                            <div class="text-muted-foreground">Keys: <span class="text-foreground" x-text="db.keys"></span></div>
                            <div class="text-muted-foreground">Expires: <span class="text-foreground" x-text="db.expires"></span></div>
                        </div>
                    </div>
                </template>
            </div>
        </div>

        <!-- Performance Metrics -->
        <div>
            <h3 class="font-semibold text-foreground mb-3">Performance</h3>
            <div class="bg-muted/30 rounded-lg p-4">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                    <div>
                        <div class="text-muted-foreground">Comandos totales</div>
                        <div class="font-medium text-foreground" x-text="Number(stats.total_commands_processed).toLocaleString()"></div>
                    </div>
                    <div>
                        <div class="text-muted-foreground">Conexiones totales</div>
                        <div class="font-medium text-foreground" x-text="Number(stats.total_connections_received).toLocaleString()"></div>
                    </div>
                    <div>
                        <div class="text-muted-foreground">Clientes conectados</div>
                        <div class="font-medium text-foreground" x-text="stats.connected_clients"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Cache Operations -->
        <div>
            <h3 class="font-semibold text-foreground mb-3">Cache Operations</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="bg-background border border-border rounded-lg p-4">
                    <h4 class="font-medium text-foreground mb-2">Hits vs Misses</h4>
                    <div class="space-y-2">
                        <div class="flex justify-between">
                            <span class="text-muted-foreground">Cache Hits:</span>
                            <span class="text-green-600 font-medium" x-text="Number(stats.keyspace_hits || 0).toLocaleString()"></span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-muted-foreground">Cache Misses:</span>
                            <span class="text-red-600 font-medium" x-text="Number(stats.keyspace_misses || 0).toLocaleString()"></span>
                        </div>
                    </div>
                </div>
                
                <div class="bg-background border border-border rounded-lg p-4">
                    <h4 class="font-medium text-foreground mb-2">Quick Actions</h4>
                    <div class="space-y-2">
                        <button 
                            @click="flushDatabase(1)"
                            class="btn btn-outline btn-sm w-full text-left"
                        >
                            <i class="fas fa-trash mr-2"></i>
                            Limpiar Cache (DB 1)
                        </button>
                        <button 
                            @click="flushDatabase(2)"
                            class="btn btn-outline btn-sm w-full text-left"
                        >
                            <i class="fas fa-trash mr-2"></i>
                            Limpiar Sesiones (DB 2)
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading State -->
    <div x-show="loading && !connected" x-transition class="text-center py-8">
        <div class="spinner mx-auto mb-4"></div>
        <p class="text-muted-foreground">Conectando a Redis...</p>
    </div>

    <!-- Last Update -->
    <div x-show="lastUpdate" class="text-xs text-muted-foreground text-center pt-4 border-t border-border mt-6">
        Última actualización: <span x-text="new Date(lastUpdate).toLocaleString()"></span>
    </div>
</div>