title = "Detalle del Cloud"
url = "/dashboard/clouds/:id"
layout = "dashboard"
is_hidden = 0

[session]
security = "user"
redirect = "login"
==
<?php
use Aero\Clouds\Models\Cloud;

function onStart()
{
    // Get authenticated user
    $user = Auth::getUser();

    if (!$user) {
        return Redirect::to('/login');
    }

    // Get cloud ID from URL parameter
    $cloudId = $this->param('id');

    // Get the cloud server and verify ownership
    $cloud = Cloud::where('id', $cloudId)
        ->where('user_id', $user->id)
        ->first();

    if (!$cloud) {
        Flash::error('Cloud server no encontrado o no tienes permisos para verlo.');
        return Redirect::to('/dashboard/clouds');
    }

    $this['cloud'] = $cloud;
    $this['user'] = $user;
}

function onActivateCloud()
{
    $user = Auth::getUser();
    $cloudId = post('cloud_id');

    $cloud = Cloud::where('id', $cloudId)
        ->where('user_id', $user->id)
        ->first();

    if (!$cloud) {
        throw new \ApplicationException('Cloud server no encontrado');
    }

    $cloud->activate();

    Flash::success('Cloud server activado exitosamente');
    return Redirect::refresh();
}

function onSuspendCloud()
{
    $user = Auth::getUser();
    $cloudId = post('cloud_id');
    $reason = post('suspension_reason');

    $cloud = Cloud::where('id', $cloudId)
        ->where('user_id', $user->id)
        ->first();

    if (!$cloud) {
        throw new \ApplicationException('Cloud server no encontrado');
    }

    $cloud->suspend($reason);

    Flash::warning('Cloud server suspendido');
    return Redirect::refresh();
}

function onRenewCloud()
{
    $user = Auth::getUser();
    $cloudId = post('cloud_id');
    $months = post('months', 1);

    $cloud = Cloud::where('id', $cloudId)
        ->where('user_id', $user->id)
        ->first();

    if (!$cloud) {
        throw new \ApplicationException('Cloud server no encontrado');
    }

    $cloud->renew($months);

    Flash::success('Cloud server renovado por ' . $months . ' mes(es)');
    return Redirect::refresh();
}
?>
==
<!-- Breadcrumb -->
<div class="text-sm breadcrumbs mb-4">
    <ul>
        <li><a href="/dashboard">Dashboard</a></li>
        <li><a href="/dashboard/clouds">Clouds</a></li>
        <li>{{ cloud.name }}</li>
    </ul>
</div>

<!-- Page Header -->
<div class="mb-6">
    <div class="flex flex-col sm:flex-row sm:items-start sm:justify-between gap-4">
        <div class="flex items-start gap-4">
            <div class="w-16 h-16 bg-gradient-to-br from-primary to-secondary rounded-xl flex items-center justify-center flex-shrink-0">
                <i class="fas fa-server text-white text-2xl"></i>
            </div>
            <div>
                <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-1">
                    {{ cloud.name }}
                </h1>
                {% if cloud.domain %}
                <p class="text-gray-600 dark:text-gray-400 flex items-center gap-2">
                    <i class="fas fa-globe text-sm"></i>
                    {{ cloud.domain }}
                </p>
                {% endif %}
                <div class="flex items-center gap-2 mt-2">
                    {% if cloud.status == 'active' %}
                        <span class="badge badge-success gap-1">
                            <i class="fas fa-check-circle"></i> Activo
                        </span>
                    {% elseif cloud.status == 'pending' %}
                        <span class="badge badge-warning gap-1">
                            <i class="fas fa-clock"></i> Pendiente de Activación
                        </span>
                    {% elseif cloud.status == 'suspended' %}
                        <span class="badge badge-error gap-1">
                            <i class="fas fa-pause-circle"></i> Suspendido
                        </span>
                    {% elseif cloud.status == 'terminated' %}
                        <span class="badge badge-ghost gap-1">
                            <i class="fas fa-times-circle"></i> Terminado
                        </span>
                    {% elseif cloud.status == 'expired' %}
                        <span class="badge badge-error gap-1">
                            <i class="fas fa-exclamation-circle"></i> Expirado
                        </span>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="flex flex-wrap gap-2">
            {% if cloud.panel_url %}
            <a href="{{ cloud.panel_url }}" target="_blank" class="btn btn-primary btn-sm gap-2">
                <i class="fas fa-external-link-alt"></i>
                Abrir Panel
            </a>
            {% endif %}

            {% if cloud.status == 'expired' or cloud.is_expired %}
            <button
                data-request="onRenewCloud"
                data-request-data="cloud_id: {{ cloud.id }}, months: 1"
                data-request-flash
                class="btn btn-success btn-sm gap-2"
            >
                <i class="fas fa-sync"></i>
                Renovar
            </button>
            {% endif %}
        </div>
    </div>
</div>

<!-- Main Grid -->
<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- Main Content -->
    <div class="lg:col-span-2 space-y-6">
        <!-- Server Information -->
        <div class="card bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700">
            <div class="card-body">
                <h2 class="card-title text-gray-900 dark:text-white mb-4">
                    <i class="fas fa-info-circle text-primary"></i>
                    Información del Servidor
                </h2>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="text-sm font-medium text-gray-500 dark:text-gray-400">Nombre</label>
                        <p class="text-gray-900 dark:text-white font-medium">{{ cloud.name }}</p>
                    </div>

                    {% if cloud.domain %}
                    <div>
                        <label class="text-sm font-medium text-gray-500 dark:text-gray-400">Dominio</label>
                        <p class="text-gray-900 dark:text-white font-medium">{{ cloud.domain }}</p>
                    </div>
                    {% endif %}

                    {% if cloud.ip_address %}
                    <div>
                        <label class="text-sm font-medium text-gray-500 dark:text-gray-400">Dirección IP</label>
                        <p class="text-gray-900 dark:text-white font-medium font-mono">{{ cloud.ip_address }}</p>
                    </div>
                    {% endif %}

                    {% if cloud.server_type %}
                    <div>
                        <label class="text-sm font-medium text-gray-500 dark:text-gray-400">Tipo de Servidor</label>
                        <p class="text-gray-900 dark:text-white font-medium capitalize">{{ cloud.server_type }}</p>
                    </div>
                    {% endif %}

                    {% if cloud.plan %}
                    <div>
                        <label class="text-sm font-medium text-gray-500 dark:text-gray-400">Plan</label>
                        <p class="text-gray-900 dark:text-white font-medium">{{ cloud.plan.name }}</p>
                    </div>
                    {% endif %}

                    {% if cloud.service %}
                    <div>
                        <label class="text-sm font-medium text-gray-500 dark:text-gray-400">Servicio</label>
                        <p class="text-gray-900 dark:text-white font-medium">{{ cloud.service.name }}</p>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Panel Access -->
        {% if cloud.panel_url or cloud.panel_user %}
        <div class="card bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700">
            <div class="card-body">
                <h2 class="card-title text-gray-900 dark:text-white mb-4">
                    <i class="fas fa-key text-primary"></i>
                    Acceso al Panel
                </h2>

                <div class="space-y-4">
                    {% if cloud.panel_url %}
                    <div>
                        <label class="text-sm font-medium text-gray-500 dark:text-gray-400">URL del Panel</label>
                        <div class="flex items-center gap-2">
                            <input type="text" readonly value="{{ cloud.panel_url }}" class="input input-bordered w-full font-mono text-sm">
                            <a href="{{ cloud.panel_url }}" target="_blank" class="btn btn-square btn-primary">
                                <i class="fas fa-external-link-alt"></i>
                            </a>
                        </div>
                    </div>
                    {% endif %}

                    {% if cloud.panel_user %}
                    <div>
                        <label class="text-sm font-medium text-gray-500 dark:text-gray-400">Usuario</label>
                        <div class="flex items-center gap-2">
                            <input type="text" readonly value="{{ cloud.panel_user }}" class="input input-bordered w-full font-mono text-sm">
                            <button onclick="navigator.clipboard.writeText('{{ cloud.panel_user }}')" class="btn btn-square btn-ghost">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                    </div>
                    {% endif %}

                    {% if cloud.panel_password %}
                    <div>
                        <label class="text-sm font-medium text-gray-500 dark:text-gray-400">Contraseña</label>
                        <div class="flex items-center gap-2">
                            <input type="password" readonly value="{{ cloud.panel_password }}" id="panel-password" class="input input-bordered w-full font-mono text-sm">
                            <button onclick="document.getElementById('panel-password').type = document.getElementById('panel-password').type === 'password' ? 'text' : 'password'" class="btn btn-square btn-ghost">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button onclick="navigator.clipboard.writeText('{{ cloud.panel_password }}')" class="btn btn-square btn-ghost">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Notes -->
        {% if cloud.notes %}
        <div class="card bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700">
            <div class="card-body">
                <h2 class="card-title text-gray-900 dark:text-white mb-4">
                    <i class="fas fa-sticky-note text-primary"></i>
                    Notas
                </h2>
                <p class="text-gray-700 dark:text-gray-300">{{ cloud.notes }}</p>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- Sidebar -->
    <div class="space-y-6">
        <!-- Status Card -->
        <div class="card bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700">
            <div class="card-body">
                <h3 class="font-semibold text-gray-900 dark:text-white mb-4">Estado y Fechas</h3>

                <div class="space-y-4">
                    <div>
                        <label class="text-sm font-medium text-gray-500 dark:text-gray-400">Fecha de Creación</label>
                        <p class="text-gray-900 dark:text-white font-medium">{{ cloud.created_date|date('d/m/Y H:i') }}</p>
                    </div>

                    {% if cloud.expiration_date %}
                    <div>
                        <label class="text-sm font-medium text-gray-500 dark:text-gray-400">Fecha de Expiración</label>
                        <p class="text-gray-900 dark:text-white font-medium">{{ cloud.expiration_date|date('d/m/Y') }}</p>
                        {% set daysLeft = cloud.days_until_expiration %}
                        {% if daysLeft is not null %}
                            {% if daysLeft < 0 %}
                                <p class="text-xs text-error mt-1">
                                    <i class="fas fa-exclamation-circle"></i> Vencido hace {{ (daysLeft * -1) }} días
                                </p>
                            {% elseif daysLeft <= 7 %}
                                <p class="text-xs text-warning mt-1">
                                    <i class="fas fa-exclamation-triangle"></i> Vence en {{ daysLeft }} días
                                </p>
                            {% else %}
                                <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                                    <i class="fas fa-clock"></i> Quedan {{ daysLeft }} días
                                </p>
                            {% endif %}
                        {% endif %}
                    </div>
                    {% endif %}

                    {% if cloud.last_renewal_date %}
                    <div>
                        <label class="text-sm font-medium text-gray-500 dark:text-gray-400">Última Renovación</label>
                        <p class="text-gray-900 dark:text-white font-medium">{{ cloud.last_renewal_date|date('d/m/Y') }}</p>
                    </div>
                    {% endif %}

                    {% if cloud.suspension_date %}
                    <div>
                        <label class="text-sm font-medium text-gray-500 dark:text-gray-400">Fecha de Suspensión</label>
                        <p class="text-gray-900 dark:text-white font-medium">{{ cloud.suspension_date|date('d/m/Y') }}</p>
                        {% if cloud.suspension_reason %}
                        <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">{{ cloud.suspension_reason }}</p>
                        {% endif %}
                    </div>
                    {% endif %}

                    <div>
                        <label class="text-sm font-medium text-gray-500 dark:text-gray-400">Auto-renovación</label>
                        <p class="text-gray-900 dark:text-white font-medium">
                            {% if cloud.auto_renew %}
                                <span class="text-success"><i class="fas fa-check-circle"></i> Activada</span>
                            {% else %}
                                <span class="text-gray-400"><i class="fas fa-times-circle"></i> Desactivada</span>
                            {% endif %}
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="card bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700">
            <div class="card-body">
                <h3 class="font-semibold text-gray-900 dark:text-white mb-4">Acciones Rápidas</h3>

                <div class="space-y-2">
                    {% if cloud.status == 'pending' %}
                    <button
                        data-request="onActivateCloud"
                        data-request-data="cloud_id: {{ cloud.id }}"
                        data-request-flash
                        data-request-confirm="¿Estás seguro de activar este cloud server?"
                        class="btn btn-success btn-sm w-full justify-start gap-2"
                    >
                        <i class="fas fa-check-circle"></i>
                        Activar Servidor
                    </button>
                    {% endif %}

                    {% if cloud.status == 'active' %}
                    <button
                        data-request="onSuspendCloud"
                        data-request-data="cloud_id: {{ cloud.id }}"
                        data-request-flash
                        data-request-confirm="¿Estás seguro de suspender este cloud server?"
                        class="btn btn-warning btn-sm w-full justify-start gap-2"
                    >
                        <i class="fas fa-pause-circle"></i>
                        Suspender Servidor
                    </button>
                    {% endif %}

                    {% if cloud.status == 'suspended' %}
                    <button
                        data-request="onActivateCloud"
                        data-request-data="cloud_id: {{ cloud.id }}"
                        data-request-flash
                        data-request-confirm="¿Reactivar este cloud server?"
                        class="btn btn-success btn-sm w-full justify-start gap-2"
                    >
                        <i class="fas fa-play-circle"></i>
                        Reactivar Servidor
                    </button>
                    {% endif %}

                    {% if cloud.status == 'expired' or cloud.is_expired %}
                    <button
                        data-request="onRenewCloud"
                        data-request-data="cloud_id: {{ cloud.id }}, months: 1"
                        data-request-flash
                        class="btn btn-primary btn-sm w-full justify-start gap-2"
                    >
                        <i class="fas fa-sync"></i>
                        Renovar 1 Mes
                    </button>
                    <button
                        data-request="onRenewCloud"
                        data-request-data="cloud_id: {{ cloud.id }}, months: 12"
                        data-request-flash
                        class="btn btn-primary btn-sm w-full justify-start gap-2"
                    >
                        <i class="fas fa-sync"></i>
                        Renovar 12 Meses
                    </button>
                    {% endif %}

                    <a href="/dashboard/support" class="btn btn-ghost btn-sm w-full justify-start gap-2">
                        <i class="fas fa-headset"></i>
                        Contactar Soporte
                    </a>

                    <a href="/dashboard/clouds" class="btn btn-ghost btn-sm w-full justify-start gap-2">
                        <i class="fas fa-arrow-left"></i>
                        Volver a Clouds
                    </a>
                </div>
            </div>
        </div>

        <!-- Related Order -->
        {% if cloud.order %}
        <div class="card bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700">
            <div class="card-body">
                <h3 class="font-semibold text-gray-900 dark:text-white mb-4">Orden Relacionada</h3>

                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-blue-100 dark:bg-blue-900/30 rounded flex items-center justify-center">
                        <i class="fas fa-shopping-cart text-blue-600 dark:text-blue-400"></i>
                    </div>
                    <div>
                        <p class="font-medium text-gray-900 dark:text-white">Orden #{{ cloud.order.id }}</p>
                        <p class="text-xs text-gray-500 dark:text-gray-400">{{ cloud.order.order_date|date('d/m/Y') }}</p>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>
